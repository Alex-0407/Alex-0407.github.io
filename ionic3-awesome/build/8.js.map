{"version":3,"sources":["../../src/pages/browser/browser.module.ts","../../src/pages/browser/browser.ts"],"names":[],"mappings":"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","file":"8.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { BrowserPage } from './browser';\n\n@NgModule({\n  declarations: [\n    BrowserPage\n  ],\n  imports: [\n    IonicPageModule.forChild(BrowserPage)\n  ],\n  entryComponents: [\n  ],\n  providers: [\n  ]\n})\nexport class BrowserPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/browser/browser.module.ts","/**\n * Created by DreamBoy on 2016/11/21.\n */\nimport { Component, ViewChild } from '@angular/core';\nimport { IonicPage, NavController, NavParams, PopoverController, Platform, Navbar } from 'ionic-angular';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { BrowserPopover } from './browser-popover';\nimport { TabsPage } from '../../pages/tabs/tabs';\n\n@IonicPage({ name: 'browser' })\n@Component({\n  selector: 'page-browser',\n  templateUrl: 'browser.html'\n})\nexport class BrowserPage {\n  browser: any = {\n    isLoaded: false, // 网页是否被加载\n    proObj: null, // 进度条对象\n    progress: 0, // 网页访问的进度条\n    secUrl: '', // 安全链接\n\n    title: '加载中',\n    url: ''\n  };\n\n  shareConfig: any = {\n    isShow: true\n  }; // 分享控制的配置\n\n  microAppCall;\n\n  constructor(public navCtrl: NavController,\n    private params: NavParams,\n    private platform: Platform,\n    private popoverCtrl: PopoverController,\n    private sanitizer: DomSanitizer) {\n    let browser = this.params.get('browser');\n    if (browser) {\n      this.browser.title = browser.title;\n      this.browser.url = browser.url;\n      this.browser.secUrl = this.sanitizer.bypassSecurityTrustResourceUrl(browser.url);\n\n      if (browser.share) {\n        this.browser.share = browser.share;\n      }\n\n    } else {\n      this.browser.secUrl = this.sanitizer.bypassSecurityTrustResourceUrl(this.browser.url);\n    }\n    this.reload();\n    let backAction = this.platform.registerBackButtonAction(() => {\n      this.navCtrl.setRoot(TabsPage, { tabindex: 1 });\n      backAction();\n    }, 2);\n    let self = this;\n    this.microAppCall = function (e) { // 接收iframe中发送过来的数据\n      if (e.data.msgType == 'refresh') {\n        self.reload();\n      } else if (e.data.msgType == 'close') {\n        self.navCtrl.push(TabsPage, { tabindex: 1 }, { direction: 'back' });\n      }\n    };\n\n    window.addEventListener('message', this.microAppCall);\n  }\n\n  @ViewChild(Navbar) navBar: Navbar;\n  ionViewDidLoad() {\n    if (!this.browser.proObj) {\n      this.browser.proObj = document.getElementById('progress');\n    }\n    this.onprogress();\n\n    this.navBar.backButtonClick = (e: UIEvent) => {\n      this.navCtrl.push(TabsPage, { tabindex: 1 } , {direction: 'back'});\n    };\n  }\n\n  ionViewDidLeave() {\n    window.removeEventListener('message', this.microAppCall);\n  }\n\n  // 生成随机数\n  private random(min: number, max: number): number {\n    return Math.floor(Math.random() * (max - min + 1) + min);\n  }\n\n  // 网页访问进度\n  private onprogress() {\n    // 随机时间\n    let timeout = this.random(10, 30);\n\n    let timer = setTimeout(() => {\n      if (this.browser.isLoaded) {\n        this.browser.proObj.style.width = '100%';\n        clearTimeout(timer);\n        return;\n      }\n\n      // 随机进度\n      this.browser.progress += this.random(1, 5);\n\n      // 随机进度不能超过 90%，以免页面还没加载完毕，进度已经 100% 了\n      if (this.browser.progress > 90) {\n        this.browser.progress = 90;\n      }\n\n      this.browser.proObj.style.width = this.browser.progress + '%';\n      this.onprogress();\n    }, timeout);\n  }\n\n  // 如果iframe页面加载成功后\n  loaded() {\n    this.browser.isLoaded = true;\n  }\n\n  // 显示Popver选项\n  presentPopover(myEvent) {\n    let cb = {\n      refresh: () => {\n        this.reload();\n      },\n      close: () => {\n        this.navCtrl.setRoot(TabsPage, { tabindex: 1 });\n      }\n    };\n\n    let popover = this.popoverCtrl.create(BrowserPopover, {\n      callback: cb\n    });\n    popover.present({\n      ev: myEvent\n    });\n  }\n\n  // 重新加载页面\n  reload() {\n    let title = this.browser.title;\n    let url = this.browser.secUrl;\n    this.browser.title = '加载中';\n    this.browser.secUrl = this.sanitizer.bypassSecurityTrustResourceUrl('');\n\n    setTimeout(() => {\n      this.browser.isLoaded = false;\n      this.browser.progress = 0;\n      if (!this.browser.proObj) {\n        this.browser.proObj = document.getElementById('progress');\n      }\n      this.onprogress();\n      this.browser.title = title;\n      this.browser.secUrl = url;\n    }, 10);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/browser/browser.ts"],"sourceRoot":""}